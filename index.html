<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfect Physics Dice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
        }

        header {
            text-align: center;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .dice-area {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .dice-container {
            width: 380px;
            height: 380px;
            background: #1a252f;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            border: 2px solid #34495e;
            cursor: pointer;
            perspective: 1000px;
        }

        #physicsDice {
            position: absolute;
            width: 80px;
            height: 80px;
            transform-style: preserve-3d;
            transition: transform 0.1s linear;
            left: 150px;
            top: 150px;
        }

        .cube-face {
            position: absolute;
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            backface-visibility: visible;
            border: 1px solid #333;
        }

        /* FIXED: Correct face positioning to match rotation logic
           When we rotate to show face X, it should have X dots */
        .face-1 { 
            background: #FF5252;
            transform: translateZ(40px);  /* Front - shows when no rotation */
        }
        .face-2 { 
            background: #4CAF50;
            transform: rotateY(180deg) translateZ(40px);  /* Back - shows at 180Â° Y */
        }
        .face-3 { 
            background: #2196F3;
            transform: rotateY(90deg) translateZ(40px);  /* Right - shows at 90Â° Y */
        }
        .face-4 { 
            background: #FFC107;
            transform: rotateY(-90deg) translateZ(40px);  /* Left - shows at -90Â° Y */
        }
        .face-5 { 
            background: #9C27B0;
            transform: rotateX(-90deg) translateZ(40px);  /* Top - shows at -90Â° X (FIXED) */
        }
        .face-6 { 
            background: #FF9800;
            transform: rotateX(90deg) translateZ(40px);  /* Bottom - shows at 90Â° X (FIXED) */
        }

        /* Dice dots styling */
        .dot {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
        }

        /* Position dots for each face */
        .face-1 .dot:nth-child(1) { top: 34px; left: 34px; }
        
        .face-2 .dot:nth-child(1) { top: 20px; left: 20px; }
        .face-2 .dot:nth-child(2) { top: 48px; left: 48px; }
        
        .face-3 .dot:nth-child(1) { top: 20px; left: 20px; }
        .face-3 .dot:nth-child(2) { top: 34px; left: 34px; }
        .face-3 .dot:nth-child(3) { top: 48px; left: 48px; }
        
        .face-4 .dot:nth-child(1) { top: 20px; left: 20px; }
        .face-4 .dot:nth-child(2) { top: 20px; left: 48px; }
        .face-4 .dot:nth-child(3) { top: 48px; left: 20px; }
        .face-4 .dot:nth-child(4) { top: 48px; left: 48px; }
        
        .face-5 .dot:nth-child(1) { top: 20px; left: 20px; }
        .face-5 .dot:nth-child(2) { top: 20px; left: 48px; }
        .face-5 .dot:nth-child(3) { top: 34px; left: 34px; }
        .face-5 .dot:nth-child(4) { top: 48px; left: 20px; }
        .face-5 .dot:nth-child(5) { top: 48px; left: 48px; }
        
        .face-6 .dot:nth-child(1) { top: 20px; left: 20px; }
        .face-6 .dot:nth-child(2) { top: 20px; left: 48px; }
        .face-6 .dot:nth-child(3) { top: 34px; left: 20px; }
        .face-6 .dot:nth-child(4) { top: 34px; left: 48px; }
        .face-6 .dot:nth-child(5) { top: 48px; left: 20px; }
        .face-6 .dot:nth-child(6) { top: 48px; left: 48px; }

        .drag-instruction {
            text-align: center;
            margin-top: 10px;
            color: #bbb;
            font-size: 0.9rem;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .balance, .bet-amount, .win-amount {
            text-align: center;
        }

        .balance h2, .bet-amount h2, .win-amount h2 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .balance-value, .bet-value, .win-value {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .betting-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .bet-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .bet-btn {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .bet-btn:hover {
            background: #45a049;
            transform: scale(1.1);
        }

        .bet-input {
            width: 100px;
            padding: 10px;
            border-radius: 5px;
            border: none;
            font-size: 1.2rem;
            text-align: center;
        }

        .number-selection {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 10px 0;
        }

        .number-option {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .number-option:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.3);
        }

        .number-option.selected {
            border: 3px solid white;
            box-shadow: 0 0 10px white;
            background: rgba(255, 255, 255, 0.4);
        }

        .game-controls {
            display: flex;
            gap: 15px;
        }

        .roll-btn, .cashout-btn, .deposit-btn, .withdraw-btn {
            padding: 12px 25px;
            font-size: 1.2rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .roll-btn {
            background: #FF5722;
            color: white;
        }

        .roll-btn:hover {
            background: #E64A19;
            transform: scale(1.05);
        }

        .roll-btn:disabled {
            background: #9E9E9E;
            cursor: not-allowed;
            transform: none;
        }

        .cashout-btn {
            background: #2196F3;
            color: white;
        }

        .cashout-btn:hover {
            background: #1976D2;
            transform: scale(1.05);
        }

        .deposit-btn {
            background: #4CAF50;
            color: white;
        }

        .deposit-btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .withdraw-btn {
            background: #FF9800;
            color: white;
        }

        .withdraw-btn:hover {
            background: #F57C00;
            transform: scale(1.05);
        }

        .result-message {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            min-height: 40px;
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            width: 100%;
        }

        .result-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 40px 60px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            text-align: center;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .result-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .result-popup.win-popup {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
        }

        .result-popup.lose-popup {
            background: linear-gradient(135deg, #F44336, #E91E63);
            color: white;
        }

        .result-popup h2 {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .result-popup p {
            font-size: 1.3rem;
            margin: 10px 0;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .popup-overlay.show {
            opacity: 1;
            pointer-events: all;
        }

        .history {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .history h2 {
            text-align: center;
            margin-bottom: 10px;
        }

        .history-list {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .history-item {
            min-width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.5rem;
            background: white;
            color: #333;
        }

        .instructions {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
            margin-top: 10px;
            text-align: center;
            width: 100%;
        }

        .odds-info {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .odd-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .bank-section {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            pointer-events: none;
        }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
            }

            .game-info {
                flex-direction: column;
                gap: 15px;
            }

            .balance-value, .bet-value, .win-value {
                font-size: 1.5rem;
            }
            
            /* Fixed mobile dice container */
            .dice-container {
                width: 280px;
                height: 280px;
                margin: 0 auto;
            }
            
            /* Fixed mobile dice size and position */
            #physicsDice {
                width: 60px;
                height: 60px;
                left: 122px;
                top: 120px;
            }

            .cube-face {
                width: 60px;
                height: 60px;
            }

            .face-1 { transform: translateZ(30px); }
            .face-2 { transform: rotateY(180deg) translateZ(30px); }
            .face-3 { transform: rotateY(90deg) translateZ(30px); }
            .face-4 { transform: rotateY(-90deg) translateZ(30px); }
            .face-5 { transform: rotateX(-90deg) translateZ(30px); }
            .face-6 { transform: rotateX(90deg) translateZ(30px); }

            /* Adjust dot sizes for mobile */
            .dot {
                width: 9px;
                height: 9px;
            }

            .face-1 .dot:nth-child(1) { top: 25.5px; left: 25.5px; }
            
            .face-2 .dot:nth-child(1) { top: 15px; left: 15px; }
            .face-2 .dot:nth-child(2) { top: 36px; left: 36px; }
            
            .face-3 .dot:nth-child(1) { top: 15px; left: 15px; }
            .face-3 .dot:nth-child(2) { top: 25.5px; left: 25.5px; }
            .face-3 .dot:nth-child(3) { top: 36px; left: 36px; }
            
            .face-4 .dot:nth-child(1) { top: 15px; left: 15px; }
            .face-4 .dot:nth-child(2) { top: 15px; left: 36px; }
            .face-4 .dot:nth-child(3) { top: 36px; left: 15px; }
            .face-4 .dot:nth-child(4) { top: 36px; left: 36px; }
            
            .face-5 .dot:nth-child(1) { top: 15px; left: 15px; }
            .face-5 .dot:nth-child(2) { top: 15px; left: 36px; }
            .face-5 .dot:nth-child(3) { top: 25.5px; left: 25.5px; }
            .face-5 .dot:nth-child(4) { top: 36px; left: 15px; }
            .face-5 .dot:nth-child(5) { top: 36px; left: 36px; }
            
            .face-6 .dot:nth-child(1) { top: 15px; left: 15px; }
            .face-6 .dot:nth-child(2) { top: 15px; left: 36px; }
            .face-6 .dot:nth-child(3) { top: 25.5px; left: 15px; }
            .face-6 .dot:nth-child(4) { top: 25.5px; left: 36px; }
            .face-6 .dot:nth-child(5) { top: 36px; left: 15px; }
            .face-6 .dot:nth-child(6) { top: 36px; left: 36px; }
            
            .game-controls, .bank-section {
                flex-direction: column;
                width: 100%;
            }
            
            .game-controls button, .bank-section button {
                width: 100%;
            }

            .number-option {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .result-popup {
                padding: 30px 40px;
                max-width: 90%;
            }

            .result-popup h2 {
                font-size: 2rem;
            }

            .result-popup p {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Perfect Physics Dice</h1>
            <p>Bet on the dots - win when they match!</p>
        </header>
        
        <div class="dice-area">
            <h2>Throw the Dice</h2>
            <div class="dice-container">
                <div id="physicsDice">
                    <div class="cube-face face-1">
                        <div class="dot"></div>
                    </div>
                    <div class="cube-face face-2">
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                    <div class="cube-face face-3">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                    <div class="cube-face face-4">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                    <div class="cube-face face-5">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                    <div class="cube-face face-6">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                </div>
            </div>
            <p class="drag-instruction">Click and drag to throw - smooth single roll!</p>
        </div>
        
        <div class="game-info">
            <div class="balance">
                <h2>Balance</h2>
                <div class="balance-value">Ksh 1000</div>
            </div>
            <div class="bet-amount">
                <h2>Current Bet</h2>
                <div class="bet-value">Ksh 0</div>
            </div>
            <div class="win-amount">
                <h2>Potential Win</h2>
                <div class="win-value">Ksh 0</div>
            </div>
        </div>
        
        <div class="betting-section">
            <h2>Place Your Bet</h2>
            
            <div class="bet-controls">
                <button class="bet-btn" id="decrease-bet">-</button>
                <input type="number" class="bet-input" id="bet-amount" value="10" min="10" max="1000">
                <button class="bet-btn" id="increase-bet">+</button>
            </div>
            
            <h3>Select a Number (1-6)</h3>
            <div class="number-selection">
                <div class="number-option selected" data-number="1">1</div>
                <div class="number-option" data-number="2">2</div>
                <div class="number-option" data-number="3">3</div>
                <div class="number-option" data-number="4">4</div>
                <div class="number-option" data-number="5">5</div>
                <div class="number-option" data-number="6">6</div>
            </div>
            
            <div class="odds-info">
                <div class="odd-item">1 dot: Pays 1x</div>
                <div class="odd-item">2 dots: Pays 2x</div>
                <div class="odd-item">3 dots: Pays 3x</div>
                <div class="odd-item">4 dots: Pays 4x</div>
                <div class="odd-item">5 dots: Pays 5x</div>
                <div class="odd-item">6 dots: Pays 6x</div>
            </div>
            
            <div class="game-controls">
                <button class="roll-btn" id="roll-dice">Throw Dice</button>
                <button class="cashout-btn" id="cash-out">Cash Out</button>
            </div>
            
            <div class="bank-section">
                <button class="deposit-btn" id="deposit">Deposit</button>
                <button class="withdraw-btn" id="withdraw">Withdraw</button>
            </div>
            
            <div class="result-message" id="result-message"></div>
        </div>

        <!-- Result Popup -->
        <div class="popup-overlay" id="popup-overlay"></div>
        <div class="result-popup" id="result-popup">
            <h2 id="popup-title"></h2>
            <p id="popup-message"></p>
            <p id="popup-amount"></p>
        </div>
        
        <div class="instructions">
            <p>Match the dots to win! Bet on a number and win if the dice shows that many dots.</p>
            <p>Higher numbers = higher payouts!</p>
        </div>
        
        <div class="history">
            <h2>Game History</h2>
            <div class="history-list" id="history-list">
                <!-- History items will be added here dynamically -->
            </div>
        </div>
    </div>

    <script>
        // Perfect Physics Dice with Single Smooth Roll
        class PerfectPhysicsDice {
            constructor(container) {
                this.container = container;
                this.dice = document.getElementById('physicsDice');
                this.isRolling = false;
                this.dragging = false;
                this.dragStart = { x: 0, y: 0 };
                
                // Detect mobile
                this.isMobile = window.innerWidth <= 600;
                
                // Position and velocity
                this.position = { x: this.isMobile ? 110 : 150, y: this.isMobile ? 110 : 150 };
                this.velocity = { x: 0, y: 0 };
                
                // Rotation and angular velocity
                this.rotation = { x: 0, y: 0, z: 0 };
                this.angularVelocity = { x: 0, y: 0, z: 0 };
                
                // Physics properties
                this.friction = 0.98;
                this.bounceDamping = 0.5;
                this.gravity = 0.3;
                this.diceSize = this.isMobile ? 60 : 80;
                this.containerWidth = this.isMobile ? 220 : 320;
                this.containerHeight = this.isMobile ? 220 : 320;
                this.angularFriction = 0.985;
                
                // Rolling control
                this.finalResult = null;
                this.rollDuration = 1800;
                this.rollStartTime = null;
                
                this.setupEventListeners();
                this.animate();
            }
            
            setupEventListeners() {
                this.container.addEventListener('mousedown', (e) => this.startDrag(e));
                this.container.addEventListener('mousemove', (e) => this.drag(e));
                this.container.addEventListener('mouseup', (e) => this.endDrag(e));
                this.container.addEventListener('mouseleave', (e) => this.cancelDrag(e));
                
                this.container.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.startDrag(e.touches[0]);
                });
                this.container.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    this.drag(e.touches[0]);
                });
                this.container.addEventListener('touchend', (e) => this.endDrag(e));
            }
            
            startDrag(e) {
                if (this.isRolling) return;
                
                const rect = this.container.getBoundingClientRect();
                this.dragStart.x = e.clientX - rect.left;
                this.dragStart.y = e.clientY - rect.top;
                this.dragging = true;
            }
            
            drag(e) {
                if (!this.dragging) return;
                
                const rect = this.container.getBoundingClientRect();
                this.dragEnd = {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            }
            
            endDrag() {
                if (!this.dragging) return;
                
                const dx = this.dragStart.x - this.dragEnd.x;
                const dy = this.dragStart.y - this.dragEnd.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 5) {
                    this.startRoll(dx, dy);
                }
                
                this.dragging = false;
                this.dragEnd = null;
            }
            
            cancelDrag() {
                this.dragging = false;
                this.dragEnd = null;
            }
            
            startRoll(dx, dy) {
                this.finalResult = Math.floor(Math.random() * 6) + 1;
                
                const forceMultiplier = 0.25;
                this.velocity.x = dx * forceMultiplier;
                this.velocity.y = dy * forceMultiplier;
                
                this.angularVelocity.x = -dy * 0.025;
                this.angularVelocity.y = dx * 0.025;
                this.angularVelocity.z = (dx - dy) * 0.01;
                
                this.isRolling = true;
                this.rollStartTime = Date.now();
                rollDiceBtn.disabled = true;
                resultMessage.textContent = '';
                
                if (gameState.currentBet > 0) {
                    gameState.balance -= gameState.currentBet;
                    updateDisplay();
                }
                
                setTimeout(() => {
                    this.smoothLanding();
                }, this.rollDuration);
            }
            
            update() {
                if (!this.isRolling) return;
                
                const elapsed = Date.now() - this.rollStartTime;
                const progress = Math.min(elapsed / this.rollDuration, 1);
                const slowdownFactor = 1 - (progress * 0.5);
                
                this.position.x += this.velocity.x * slowdownFactor;
                this.position.y += this.velocity.y * slowdownFactor;
                this.velocity.y += this.gravity * slowdownFactor;
                
                this.rotation.x += this.angularVelocity.x * slowdownFactor;
                this.rotation.y += this.angularVelocity.y * slowdownFactor;
                this.rotation.z += this.angularVelocity.z * slowdownFactor;
                
                this.handleCollisions();
                
                this.velocity.x *= this.friction;
                this.velocity.y *= this.friction;
                this.angularVelocity.x *= this.angularFriction;
                this.angularVelocity.y *= this.angularFriction;
                this.angularVelocity.z *= this.angularFriction;
                
                this.dice.style.left = `${this.position.x}px`;
                this.dice.style.top = `${this.position.y}px`;
                this.dice.style.transform = `
                    rotateX(${this.rotation.x}rad) 
                    rotateY(${this.rotation.y}rad) 
                    rotateZ(${this.rotation.z}rad)
                `;
            }
            
            handleCollisions() {
                const halfSize = this.diceSize / 2;
                const padding = 5;
                
                if (this.position.x - halfSize < padding) {
                    this.position.x = halfSize + padding;
                    this.velocity.x = Math.abs(this.velocity.x) * this.bounceDamping;
                }
                else if (this.position.x + halfSize > this.containerWidth - padding) {
                    this.position.x = this.containerWidth - halfSize - padding;
                    this.velocity.x = -Math.abs(this.velocity.x) * this.bounceDamping;
                }
                
                if (this.position.y - halfSize < padding) {
                    this.position.y = halfSize + padding;
                    this.velocity.y = Math.abs(this.velocity.y) * this.bounceDamping;
                }
                else if (this.position.y + halfSize > this.containerHeight - padding) {
                    this.position.y = this.containerHeight - halfSize - padding;
                    this.velocity.y = -Math.abs(this.velocity.y) * this.bounceDamping;
                }
            }
            
            smoothLanding() {
                this.velocity.x = 0;
                this.velocity.y = 0;
                this.angularVelocity.x = 0;
                this.angularVelocity.y = 0;
                this.angularVelocity.z = 0;
                
                this.snapToResult(this.finalResult);
            }
            
            snapToResult(result) {
                let targetRotationX, targetRotationY, targetRotationZ;
                
                // FIXED: Corrected rotations to match the CSS transforms
                // Now face-5 has rotateX(-90deg) and face-6 has rotateX(90deg)
                switch(result) {
                    case 1: // Front face (1 dot)
                        targetRotationX = 0;
                        targetRotationY = 0;
                        targetRotationZ = 0;
                        break;
                    case 2: // Back face (2 dots)
                        targetRotationX = 0;
                        targetRotationY = Math.PI;
                        targetRotationZ = 0;
                        break;
                    case 4: // Right face (3 dots)
                        targetRotationX = 0;
                        targetRotationY = Math.PI / 2;
                        targetRotationZ = 0;
                        break;
                    case 3: // Left face (4 dots)
                        targetRotationX = 0;
                        targetRotationY = -Math.PI / 2;
                        targetRotationZ = 0;
                        break;
                    case 6: // Top face (5 dots) - FIXED to -90Â° X
                        targetRotationX = -Math.PI / 2;
                        targetRotationY = 0;
                        targetRotationZ = 0;
                        break;
                    case 5: // Bottom face (6 dots) - FIXED to 90Â° X
                        targetRotationX = Math.PI / 2;
                        targetRotationY = 0;
                        targetRotationZ = 0;
                        break;
                }
                
                this.animateToFinalPosition(targetRotationX, targetRotationY, targetRotationZ, result);
            }
            
            animateToFinalPosition(targetX, targetY, targetZ, result) {
                const duration = 400;
                const startTime = Date.now();
                const startRotation = { ...this.rotation };
                
                const animate = () => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const easeOut = 1 - Math.pow(1 - progress, 3);
                    
                    this.rotation.x = startRotation.x + (targetX - startRotation.x) * easeOut;
                    this.rotation.y = startRotation.y + (targetY - startRotation.y) * easeOut;
                    this.rotation.z = startRotation.z + (targetZ - startRotation.z) * easeOut;
                    
                    this.dice.style.transform = `
                        rotateX(${this.rotation.x}rad) 
                        rotateY(${this.rotation.y}rad) 
                        rotateZ(${this.rotation.z}rad)
                    `;
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        this.isRolling = false;
                        setTimeout(() => {
                            finishRoll(result);
                            rollDiceBtn.disabled = false;
                        }, 100);
                    }
                };
                
                animate();
            }
            
            animate() {
                this.update();
                requestAnimationFrame(() => this.animate());
            }
            
            quickThrow() {
                if (this.isRolling) return;
                
                this.finalResult = Math.floor(Math.random() * 6) + 1;
                
                this.velocity.x = (Math.random() - 0.5) * 5;
                this.velocity.y = (Math.random() - 0.5) * 3;
                this.angularVelocity.x = (Math.random() - 0.5) * 0.3;
                this.angularVelocity.y = (Math.random() - 0.5) * 0.3;
                this.angularVelocity.z = (Math.random() - 0.5) * 0.15;
                
                this.isRolling = true;
                this.rollStartTime = Date.now();
                rollDiceBtn.disabled = true;
                
                if (gameState.currentBet > 0) {
                    gameState.balance -= gameState.currentBet;
                    updateDisplay();
                }
                
                resultMessage.textContent = '';
                
                setTimeout(() => {
                    this.smoothLanding();
                }, this.rollDuration);
            }
        }

        // Game state
        const gameState = {
            balance: 1000,
            currentBet: 0,
            selectedNumber: 1,
            isRolling: false,
            history: [],
            odds: {
                1: 1,
                2: 2,
                3: 3,
                4: 4,
                5: 5,
                6: 6
            }
        };

        // DOM elements
        const balanceValue = document.querySelector('.balance-value');
        const betValue = document.querySelector('.bet-value');
        const winValue = document.querySelector('.win-value');
        const betAmountInput = document.getElementById('bet-amount');
        const decreaseBetBtn = document.getElementById('decrease-bet');
        const increaseBetBtn = document.getElementById('increase-bet');
        const numberOptions = document.querySelectorAll('.number-option');
        const rollDiceBtn = document.getElementById('roll-dice');
        const cashOutBtn = document.getElementById('cash-out');
        const depositBtn = document.getElementById('deposit');
        const withdrawBtn = document.getElementById('withdraw');
        const resultMessage = document.getElementById('result-message');
        const historyList = document.getElementById('history-list');
        const diceContainer = document.querySelector('.dice-container');

        const perfectDice = new PerfectPhysicsDice(diceContainer);

        function initGame() {
            updateDisplay();
            
            decreaseBetBtn.addEventListener('click', () => adjustBet(-10));
            increaseBetBtn.addEventListener('click', () => adjustBet(10));
            betAmountInput.addEventListener('change', updateBetFromInput);
            
            numberOptions.forEach(option => {
                option.addEventListener('click', () => selectNumber(parseInt(option.dataset.number)));
            });
            
            rollDiceBtn.addEventListener('click', () => perfectDice.quickThrow());
            cashOutBtn.addEventListener('click', cashOut);
            depositBtn.addEventListener('click', depositFunds);
            withdrawBtn.addEventListener('click', withdrawFunds);
        }

        function updateDisplay() {
            balanceValue.textContent = `Ksh ${gameState.balance}`;
            betValue.textContent = `Ksh ${gameState.currentBet}`;
            
            const potentialWin = gameState.currentBet * gameState.odds[gameState.selectedNumber];
            winValue.textContent = `Ksh ${potentialWin}`;
            
            numberOptions.forEach(option => {
                if (parseInt(option.dataset.number) === gameState.selectedNumber) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        }

        function adjustBet(amount) {
            const newBet = parseInt(betAmountInput.value) + amount;
            if (newBet >= 10 && newBet <= gameState.balance) {
                betAmountInput.value = newBet;
                gameState.currentBet = newBet;
                updateDisplay();
            }
        }

        function updateBetFromInput() {
            let bet = parseInt(betAmountInput.value);
            if (isNaN(bet) || bet < 10) {
                bet = 10;
                betAmountInput.value = 10;
            } else if (bet > gameState.balance) {
                bet = gameState.balance;
                betAmountInput.value = gameState.balance;
            }
            
            gameState.currentBet = bet;
            updateDisplay();
        }

        function selectNumber(number) {
            gameState.selectedNumber = number;
            updateDisplay();
        }

        function finishRoll(result) {
            const won = result === gameState.selectedNumber;
            
            const popup = document.getElementById('result-popup');
            const popupOverlay = document.getElementById('popup-overlay');
            const popupTitle = document.getElementById('popup-title');
            const popupMessage = document.getElementById('popup-message');
            const popupAmount = document.getElementById('popup-amount');
            
            if (won) {
                const winAmount = gameState.currentBet * gameState.odds[result];
                gameState.balance += winAmount;
                
                popup.className = 'result-popup win-popup show';
                popupTitle.textContent = 'ðŸŽ‰ YOU WIN! ðŸŽ‰';
                popupMessage.textContent = `Dice showed ${result} dot${result > 1 ? 's' : ''}!`;
                popupAmount.textContent = `You won Ksh ${winAmount}!`;
                
                playWinSound();
                createConfetti();
            } else {
                popup.className = 'result-popup lose-popup show';
                popupTitle.textContent = 'ðŸ˜ž YOU LOSE';
                popupMessage.textContent = `Dice showed ${result} dot${result > 1 ? 's' : ''} (You bet ${gameState.selectedNumber})`;
                popupAmount.textContent = `Better luck next time!`;
                
                playLoseSound();
            }
            
            popupOverlay.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
                popupOverlay.classList.remove('show');
            }, 3000);
            
            addToHistory(result, won, won ? winAmount : 0);
            
            updateDisplay();
            gameState.currentBet = 0;
            betAmountInput.value = 10;
        }

        function cashOut() {
            if (perfectDice.isRolling) {
                resultMessage.textContent = "Please wait for the current roll to finish!";
                return;
            }
            
            resultMessage.textContent = `Cashed out Ksh ${gameState.balance}!`;
            
            gameState.balance = 1000;
            gameState.currentBet = 0;
            betAmountInput.value = 10;
            updateDisplay();
        }

        function depositFunds() {
            const amount = prompt("Enter deposit amount:");
            if (amount && !isNaN(amount) && parseInt(amount) > 0) {
                gameState.balance += parseInt(amount);
                updateDisplay();
                resultMessage.textContent = `Deposited Ksh ${amount} successfully!`;
                addToHistory(`Deposit`, true, parseInt(amount));
            }
        }

        function withdrawFunds() {
            const amount = prompt("Enter withdrawal amount:");
            if (amount && !isNaN(amount) && parseInt(amount) > 0) {
                if (parseInt(amount) > gameState.balance) {
                    resultMessage.textContent = "Insufficient balance!";
                    return;
                }
                
                gameState.balance -= parseInt(amount);
                updateDisplay();
                resultMessage.textContent = `Withdrew Ksh ${amount} successfully!`;
                addToHistory(`Withdrawal`, true, parseInt(amount));
            }
        }

        function addToHistory(number, isWin, amount = 0) {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            
            if (typeof number === 'string') {
                historyItem.textContent = number === 'Deposit' ? '+' : '-';
                historyItem.title = `${number}: Ksh ${amount}`;
            } else {
                historyItem.textContent = number;
                historyItem.title = isWin ? `Won: Ksh ${amount}` : `Lost`;
            }
            
            historyItem.style.background = isWin ? '#4CAF50' : '#F44336';
            historyItem.style.color = 'white';
            
            historyList.prepend(historyItem);
            
            if (historyList.children.length > 10) {
                historyList.removeChild(historyList.lastChild);
            }
            
            gameState.history.unshift({ number, isWin, amount });
            if (gameState.history.length > 10) {
                gameState.history.pop();
            }
        }

        function playWinSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const notes = [523.25, 659.25, 783.99, 1046.50];
                notes.forEach((freq, i) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.1);
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime + i * 0.1);
                    gainNode.gain.linearRampToValueAtTime(0.15, audioContext.currentTime + i * 0.1 + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.3);
                    
                    oscillator.start(audioContext.currentTime + i * 0.1);
                    oscillator.stop(audioContext.currentTime + i * 0.1 + 0.3);
                });
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        function playLoseSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(220, audioContext.currentTime + 0.5);
                
                gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        function createConfetti() {
            const colors = ['#FF5252', '#4CAF50', '#2196F3', '#FFC107', '#9C27B0', '#FF9800'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-10px';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                document.body.appendChild(confetti);
                
                const animation = confetti.animate([
                    { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(${100 + Math.random() * 50}vh) rotate(${360 + Math.random() * 360}deg)`, opacity: 0 }
                ], {
                    duration: 2000 + Math.random() * 2000,
                    easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)'
                });
                
                animation.onfinish = () => {
                    document.body.removeChild(confetti);
                };
            }
        }

        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>